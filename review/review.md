# CodeReview
- 2020年3月24日(火)15時〜16時30分
- Reviewer(SG)：株式会社ソニックガーデン 西見さん・川村さん
- Reviewee(DIC)：2020年1月期 松橋・三原・渡邉チーム

## vending_machine.rb
1. tapメソッド(17行目)
- 代入{@total = 0}するのが違和感ある。tapメソッドはブロックの引数とって何かするときに使います(SG)
- 今の書き方は(テクニカルだけど)普通の書き方じゃない。自分用。タイプ数で(SG)
- productionだと読みにくいから自重する。より読みやすさ重視だから(SG)
- コードは短い方が良いという訳じゃない。分かりやすさ・読みやすさ重視(SG)

2. VendingMachineクラス(1行目〜39行目)
- お金の処理や在庫の処理など責任を多く持ちすぎ？(DIC)
- クラスを作るときは何を基準に考えると良いか(DIC)
- 一般論として「名詞のものは分けましょう」という考え(DIC)
  - コード書いてて、ちょっと扱いづらいなと思ったときに、どうやったら扱いやすくなるかなって考えて分けるのであれば学びになる(SG)
  - 「名詞のものは分けましょう」で(逆に)何でうまくいくのかを捉えてないと(SG)
  - クラスを考えるときは①使いやすいかの抽象化と②具体的に何を意味しているか(現実に即しているか)の抽象化のバランス(SG)
  - ①と②が良い感じのバランス＝分かりやすいコード(SG)
  - ただ答えがない。考え続ける必要(SG)
  - コード書いてるときにクラス変えることも。あとはテスト書いてるとき(テスト書きづらくなるとき)クラス変える。コードを文章として読んだとき違和感があるとか(SG)
  - コードがぎゅうぎゅうにあってそこから切り分けた方が学びはあるかもしれない(SG)
    - 例えばDrinkクラス、実際は格納している場所みたいなイメージ(SG)
    - だからDrinkLaneの方がしっくり来る(SG)
    - コード自体はシンプルで良い。あとは拡張性でadd_laneメソッドを追加するとか(SG)
    - ポイントは抽象化の粒度が適切かという話と、データ構造できるだけメソッドで隠してあげると。ハッシュに依存したコード(テクニカルなコード)が増えていくのはあまり良くはない(SG)

3. mapメソッド(26行目)
- 戻り値にnilが来る可能性があるのはよろしくない。selectかcompactを使いましょう(SG)
- nilはない方が良い。Rubyでコーディングする限りnilに悩まされるから(SG)
- 違うのが混じっている配列は扱いづらいし、nilが買えるというよく分からないことになりかねない(SG)
- 意図的にnilを扱うこともあるけど、本当にレアケース(SG)

4. internメソッド(32行目)
- tapメソッド(17行目)もだけどテクニカルなコードを分かってなくても読めるようにするの大事(SG)

## vending_machine_spec.rb
1. describe(7行目以下)
- describeに分けなくて良かったかも。ちょっと冗長なので。シナリオテストとして書いた方が(SG)
- describeで書くなら、insertの機能だけに着目したテストにする(SG)
- describeがメソッドテストで、itがシナリオテストみたいな。ベタっとシナリオに沿って順に書いていけば(SG)

2. spec
- テストも書いてあって良い。素晴らしいと思います(SG)

## Q&A
1. attr_accessor(41行目)
- Drinkクラスでattr_accessorを使いましたが現場でもattr_accessorを使いますか。attr_accessorは御法度？(DIC)
  - 前提としてattr_readerで考えるけどattr_accessor自体は別に問題ない。ただattr_accessorである理由が必要(SG)

2. リモートワーク
- SGさんはリモートワークで有名ですが、1日のタイムスケジュールとか、リモートワークはこんな感じみたいなのを教えてください(DIC)
  - タイムスケジュールは人それぞれ(例えば子どもを保育園に送り迎えがある人はけっこう規則正しく9時〜18時前まで)(SG)
  - (SGの特徴だと思いますけど)時間帯が大幅にはズレない。完全に1人でやる感じじゃなくて、チームで話し合った方が良いので。一般的な時間で、みんなでコアタイムで働いている(SG)
  - リモートワークはツールをいかに使うかが大事。SGはRemotty(リモティ)というリモートワークに特化したチャットツール活用(SG)

3. コロナウイルス
- コロナウイルスの影響で景気が悪くなると思いますが、エンジニア目線でIT業界もかなり影響があると思いますか(特に人材採用)(DIC)
  - (受託開発で言えば)タイムラグで半年後とかに響いてくる。自社開発であれば特化した業種に応じて影響を受ける。例えばグルメサイトとかは飲食業がかなりダメージがあるので、その影響で採用見送りということもあるかもしれない(SG)

4. キャリアビジョン
- 50代・60代のときのビジョンはありますか。(変化が激しい業界なので)会社に内緒でPython(Django)の勉強中など、差し支えない範囲で教えていただけたら幸いです(DIC)
  - SGは「ずっとプログラマとしてやっていこう」という会社で、自分もプログラマを続けたい(SG)
  - 人それぞれだけど、内緒でPythonというより、おおっぴらに技術の話はする(SG)
  - 興味があるから、面白そうだからやるという感じ。もしRailsが廃れたときに、Djangoも生き残ってるかは分からないので(SG)
  - 年齢が上がるほど、知識とかスキルそのものも必要だけど、そもそも自分を必要としてくれる人が身の回りに居るかどうかがシビアな問題。プログラマ、技術だけに限らず(管理職じゃなくても)、社会に対してどう影響を及ぼすか、自分がどういうことなら価値を生み出せるかが大事。人それぞれ、向いている分野もあるだろうし。ちょっと戦略考えて(SG)
  - 人生100年時代、50代・60代のときの働き方を考えるのはすごい重要(SG)

5. tapメソッド(17行目)
- 自分用(vending_machine.rbの1. tapメソッドの2ポツ目参照)というのは具体的にどういう意味でしょうか(DIC)
  - 副作用のあるメソッドはできるだけ避ける。副作用というのは「インプットとアウトプット(インスタンスの状態は変わらない)、以外で動作がある(状態を変えてしまう)メソッド」のこと(SG)
  - もし変えるのならはっきり変えること。しれっと変えるのはダメ(SG)
  - 入力と出力のパターンが制限されていれば(単純にメソッドを実行すれば良いので)テストも書きやすくなる(SG)
  - 状態変化をなくすと非常にシンプルでテストもしやすいというメリット(SG)
  - 副作用のないコードを書くのはなかなか難しいけど、クラス設計をうまく工夫すればできる(SG)

6. internメソッド(32行目)
- 文字列をシンボルに変えるto_symメソッドとinternメソッド。どちらも同じ挙動に見えるがどちらを使うべきか。メソッド選ぶときに基準があるのか(DIC)
  - 良い質問ですね(SG)
  - どちらも同じ挙動なのでチーム内で決めましょう。どっちかに統一した方が良い(SG)
  - メソッドの選定基準①メソッドの挙動(同じ挙動に見えるが実は違うのではないかという観点から下記のリファレンスをご紹介いただきました)②よく使うメソッドであればプロジェクトチーム内で話し合ってどちらを使うか決める(SG)
  - rubyのメソッドの裏側がどのように実装されているかリファレンスで確認できる(SG)
  - https://docs.ruby-lang.org/en/2.6.0/String.html#method-i-intern

7. end.compact(SGさんが書き足したコード)
- compactメソッドは「nilを排除した配列を返す」と理解してますが、endの後にメソッドを続けることはあるのか(DIC)
  - よくある(SG)
  - Rubyでは常にnilが返ってくる可能性を考慮しなければならない(SG)

8. end.map(&:name)(SGさんが書き足したコード)
- 「&:」の後のコードの意味がいまいち分からない(DIC)
  - (「&:」の後のコードを説明した上で)「&:」はよく見かけるRubyの省略記法(省略しない書き方も併せて説明)(SG)
  - ちなみにリファレンスを参照するときに『Dash』というツールを使ってます。便利です(SG)
  - https://kapeli.com/dash
